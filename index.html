<!doctype html>
<html lang="zh-HK">
<head>
  <meta charset="utf-8" />
  <title>PDF â†’ Gemini ç´”æ–‡å­—å•ç­” (Frontend Only)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script type="importmap">
    {
      "imports": {
        "@google/genai": "https://esm.run/@google/genai"
      }
    }
  </script>
  <style>
    body { font-family: system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans TC",sans-serif; margin: 24px; }
    .card { max-width: 880px; margin: 0 auto; padding: 20px; border: 1px solid #e5e5e5; border-radius: 12px; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
    textarea { width: 100%; min-height: 120px; padding: 10px; }
    #answer { white-space: pre-wrap; border: 1px solid #eee; border-radius: 8px; padding: 12px; min-height: 140px; }
    button { padding: 10px 16px; border-radius: 8px; border: 1px solid #ccc; cursor: pointer; }
    small.muted { color: #666; }
  </style>
</head>
<body>
  <div class="card">
    <h2>ğŸ“„ PDF â†’ Gemini ç´”æ–‡å­—å•ç­”</h2>
    <p><small class="muted">æ”¯æ´ PDF â‰¤ 20MBã€‚ä½ ç¾æ™‚ä¿‚ 2MBï¼Œç›´æ¥ç”¨ inlineDataã€‚</small></p>

    <div class="row">
      <input id="pdf" type="file" accept="application/pdf" />
      <button id="ask">é€å‡º</button>
    </div>

    <p>
      <textarea id="q" placeholder="è«‹è¼¸å…¥å•é¡Œã€‚ä¾‹å¦‚ï¼šè«‹æ ¹æ“šæ–‡ä»¶å…§å®¹ï¼Œç”¨è¦é»åˆ—å‡ºé‡é»ï¼Œæ¨™æ³¨(é ç¢¼)ï¼Œæ‰€æœ‰å›è¦†åªéœ€ç´”æ–‡å­—ï¼Œæ¯‹é ˆä»»ä½•æª”æ¡ˆæˆ–ä»£ç¢¼å€å¡Šã€‚"></textarea>
    </p>

    <h3>ç­”æ¡ˆï¼ˆç´”æ–‡å­—ï¼‰</h3>
    <div id="answer"></div>
  </div>

<script type="module">
import { GoogleGenerativeAI, createPart } from "@google/genai";

// 1) ç›´æ¥ä½¿ç”¨å·²è¨­å¥½ HTTP referrer é™åˆ¶çš„ API Key
const API_KEY = "YOUR_API_KEY"; // â† æ›æˆä½ çš„ Key
const MODEL_ID = "gemini-2.0-flash"; // æˆ– "gemini-2.5-flash"

const ai = new GoogleGenerativeAI(API_KEY);
const model = ai.getGenerativeModel({ model: MODEL_ID });

const $ = sel => document.querySelector(sel);
$("#ask").addEventListener("click", async () => {
  const out = $("#answer");
  out.textContent = "";
  try {
    const file = $("#pdf").files?.[0];
    if (!file) { out.textContent = "è«‹å…ˆé¸æ“‡ PDF æª”æ¡ˆã€‚"; return; }
    if (file.type !== "application/pdf") { out.textContent = "åªæ”¯æ´ PDFã€‚"; return; }

    // 2) æª”æ¡ˆè½‰ base64ï¼ˆinlineData é©åˆ â‰¤20MBï¼‰
    const base64 = await file.arrayBuffer().then(buf => {
      let bin = "";
      const bytes = new Uint8Array(buf);
      const chunk = 0x8000;
      for (let i = 0; i < bytes.length; i += chunk) {
        bin += String.fromCharCode(...bytes.subarray(i, i + chunk));
      }
      return btoa(bin);
    });

    // 3) å•é¡Œï¼ˆåŠ å…¥ã€Œç´”æ–‡å­—è¼¸å‡ºã€æç¤ºï¼‰
    const userQ = ($("#q").value || "è«‹ç”¨è¦é»åˆ—å‡ºæ–‡ä»¶é‡é»ï¼Œä¸¦æ–¼æ¯é»å¾Œæ¨™æ³¨(é ç¢¼)ã€‚")
      + "\n\nè¦æ±‚ï¼šä»¥ç´”æ–‡å­—ä½œç­”ï¼Œä¸è¦ä»£ç¢¼å€å¡Šã€ä¸è¦ä¸Šå‚³æˆ–ç”¢ç”Ÿä»»ä½•æª”æ¡ˆã€‚";

    out.textContent = "â³ ç”Ÿæˆä¸­â€¦";

    // 4) å‘¼å« Geminiï¼Œé™„ä¸Š PDFï¼ˆinlineDataï¼‰
    const result = await model.generateContent({
      contents: [
        {
          role: "user",
          parts: [
            { text: userQ },
            createPart({
              inlineData: {
                mimeType: "application/pdf",
                data: base64
              }
            })
          ]
        }
      ]
    });

    // 5) é¡¯ç¤ºç´”æ–‡å­—ç­”æ¡ˆ
    out.textContent = result.response.text() || "ï¼ˆæ²’æœ‰æ–‡å­—å›å‚³ï¼‰";
  } catch (err) {
    console.error(err);
    const msg = (err && err.message) ? err.message : String(err);
    $("#answer").textContent = "ç™¼ç”ŸéŒ¯èª¤ï¼š\n" + msg;
  }
});
</script>
</body>
</html>
